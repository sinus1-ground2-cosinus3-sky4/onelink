import{computed as y,defineComponent as P,h as j,inject as L,onMounted as h,onUnmounted as M,provide as H,ref as T,watch as Z,watchEffect as E,normalizeClass as ee}from"vue";import{useId as te}from'../../hooks/use-id.js';import{match as V}from'../../utils/match.js';import{env as ne}from'../../utils/env.js';import{Features as re,omit as ae,render as _,RenderStrategy as f}from'../../utils/render.js';import{Reason as U,transition as K}from'./utils/transition.js';import{dom as k}from'../../utils/dom.js';import{useOpenClosedProvider as le,State as w,useOpenClosed as ie,hasOpenClosed as se}from'../../internal/open-closed.js';function d(e=""){return e.split(" ").filter(t=>t.trim().length>1)}let B=Symbol("TransitionContext");var oe=(l=>(l.Visible="visible",l.Hidden="hidden",l))(oe||{});function ue(){return L(B,null)!==null}function fe(){let e=L(B,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}function de(){let e=L(F,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}let F=Symbol("NestingContext");function x(e){return"children"in e?x(e.children):e.value.filter(({state:t})=>t==="visible").length>0}function z(e){let t=T([]),l=T(!1);h(()=>l.value=!0),M(()=>l.value=!1);function s(r,n=f.Hidden){let i=t.value.findIndex(({id:a})=>a===r);i!==-1&&(V(n,{[f.Unmount](){t.value.splice(i,1)},[f.Hidden](){t.value[i].state="hidden"}}),!x(t)&&l.value&&(e==null||e()))}function v(r){let n=t.value.find(({id:i})=>i===r);return n?n.state!=="visible"&&(n.state="visible"):t.value.push({id:r,state:"visible"}),()=>s(r,f.Unmount)}return{children:t,register:v,unregister:s}}let $=re.RenderStrategy,ve=P({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:l,slots:s,expose:v}){if(!ue()&&se())return()=>j(me,{...e,onBeforeEnter:()=>t("beforeEnter"),onAfterEnter:()=>t("afterEnter"),onBeforeLeave:()=>t("beforeLeave"),onAfterLeave:()=>t("afterLeave")},s);let r=T(null),n=T("visible"),i=y(()=>e.unmount?f.Unmount:f.Hidden);v({el:r,$el:r});let{show:a,appear:g}=fe(),{register:S,unregister:p}=de(),R={value:!0},m=te(),c={value:!1},N=z(()=>{c.value||(n.value="hidden",p(m),t("afterLeave"))});h(()=>{let o=S(m);M(o)}),E(()=>{if(i.value===f.Hidden&&!!m){if(a&&n.value!=="visible"){n.value="visible";return}V(n.value,{["hidden"]:()=>p(m),["visible"]:()=>S(m)})}});let O=d(e.enter),A=d(e.enterFrom),q=d(e.enterTo),D=d(e.entered),G=d(e.leave),J=d(e.leaveFrom),Q=d(e.leaveTo);h(()=>{E(()=>{if(n.value==="visible"){let o=k(r);if(o instanceof Comment&&o.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function W(o){let C=R.value&&!g.value,u=k(r);!u||!(u instanceof HTMLElement)||C||(c.value=!0,a.value&&t("beforeEnter"),a.value||t("beforeLeave"),o(a.value?K(u,O,A,q,D,b=>{c.value=!1,b===U.Finished&&t("afterEnter")}):K(u,G,J,Q,D,b=>{c.value=!1,b===U.Finished&&(x(N)||(n.value="hidden",p(m),t("afterLeave")))})))}return h(()=>{Z([a],(o,C,u)=>{W(u),R.value=!1},{immediate:!0})}),H(F,N),le(y(()=>V(n.value,{["visible"]:w.Open,["hidden"]:w.Closed}))),()=>{let{appear:o,show:C,enter:u,enterFrom:b,enterTo:Te,entered:he,leave:ge,leaveFrom:Se,leaveTo:ce,...I}=e,X={ref:r},Y={...I,...g&&a&&ne.isServer?{class:ee([I.class,...O,...A])}:{}};return _({theirProps:Y,ourProps:X,slot:{},slots:s,attrs:l,features:$,visible:n.value==="visible",name:"TransitionChild"})}}}),pe=ve,me=P({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:l,slots:s}){let v=ie(),r=y(()=>e.show===null&&v!==null?V(v.value,{[w.Open]:!0,[w.Closed]:!1}):e.show);E(()=>{if(![!0,!1].includes(r.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let n=T(r.value?"visible":"hidden"),i=z(()=>{n.value="hidden"}),a=T(!0),g={show:r,appear:y(()=>e.appear||!a.value)};return h(()=>{E(()=>{a.value=!1,r.value?n.value="visible":x(i)||(n.value="hidden")})}),H(F,i),H(B,g),()=>{let S=ae(e,["show","appear","unmount","onBeforeEnter","onBeforeLeave","onAfterEnter","onAfterLeave"]),p={unmount:e.unmount};return _({ourProps:{...p,as:"template"},theirProps:{},slot:{},slots:{...s,default:()=>[j(pe,{onBeforeEnter:()=>t("beforeEnter"),onAfterEnter:()=>t("afterEnter"),onBeforeLeave:()=>t("beforeLeave"),onAfterLeave:()=>t("afterLeave"),...l,...p,...S},s.default)]},attrs:{},features:$,visible:n.value==="visible",name:"Transition"})}}});export{ve as TransitionChild,me as TransitionRoot};
